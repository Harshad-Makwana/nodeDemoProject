<!DOCTYPE html>
<html lang="en">
<head>
    {{>header}}
</head>
<body>
    {{>navbar}}

    
    <div class="container">  
        <div class="row">
            <div class="col-md-4 profile">
                <h1>User List</h1>
            </div>
        </div>
        <table id="data-table" class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Name</th>
                    <th>Phone number</th>
                    <th>DOB</th>
                </tr>
            </thead>
            <tbody class="tbody">
            </tbody>
        </table>

        <div>
            <input type="text" name="search" class="input-search custom-search" id="custom-search" placeholder="Search name">
            <table class="table table-striped table-hover" id="custom-table">
                <thead>
                    <tr>
                    <th scope="col">Email</th>
                    <th scope="col">Name</th>
                    <th scope="col">Phone number</th>
                    <th scope="col">DOB</th>
                    </tr>
                </thead>
                <tbody class="tbody">
                </tbody>
            </table>

            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-end">
                    <li class="page-item"><a class="page-link">Previous</a></li>
                    <li class="page-item"><a class="page-link">1</a></li>
                    <li class="page-item"><a class="page-link" >2</a></li>
                    <li class="page-item"><a class="page-link">3</a></li>
                    <li class="page-item"><a class="page-link">Next</a></li>
                </ul>
            </nav>
        </div>
    </div>      
        
</body>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js" ></script>
<script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js" ></script>
<script>
    $(document).ready(function() {

        var dataJson;

        load_data();

        function load_data() {
            $.ajax({
                url: "users-list",
                method: "POST",
                dataType:"JSON",
                success:function(data) {
                    
                    dataJson = data;

                    let tableData = '';
                    if(data.length > 0) {       
                        for(let count = 0; count < data.length; count++) {
                            tableData += `
                                <tr>
                                    <th scope="row">` + data[count].email + `</th>
                                    <td>` + data[count].name + `</td>
                                    <td>` + data[count].phone_number + `</td>
                                    <td>` +  new Date(data[count].dob).toLocaleDateString() + `</td>
                                </tr>
                            `;
                        }
                    }
                    $('.tbody').html(tableData);
                    $('#data-table').DataTable();
                }
            });
        }


        function customSearch() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("custom-search");
            filter = input.value.toUpperCase();
            table = document.getElementById("custom-table");
            tr = table.getElementsByTagName("tr");

            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }       
            }
        }

        $("#custom-search").on("keyup", customSearch);
    })
</script>
</html>